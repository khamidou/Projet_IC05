// harry plotter 0.8
// ~L~ nikomomo@gmail.com 2009-2012
// https://github.com/nikopol/Harry-Plotter
var harry=function(f){var Z="#88a4d7 #d685c9 #86d685 #ffc34f #93c2ea #f28989 #f9eb8a".split(" "),H=function(d,a,e){var b,d=d&&d.constructor==Array&&3==d.length?d:(b=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(d))?[parseInt(b[1],10),parseInt(b[2],10),parseInt(b[3],10)]:(b=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(d))?[2.55*parseFloat(b[1]),2.55*parseFloat(b[2]),2.55*parseFloat(b[3])]:(b=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(d))?[parseInt(b[1],16),parseInt(b[2],16),parseInt(b[3],16)]:(b=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(d))?[parseInt(b[1]+b[1],16),parseInt(b[2]+b[2],16),parseInt(b[3]+b[3],16)]:[0,0,0];"array"!=typeof a&&(a=[a,a,a]);for(b=0;3>b;++b)d[b]=Math.max(Math.min(d[b]+a[b],255),0);return void 0!=e?"rgba("+d.join(",")+","+e+")":"rgb("+d.join(",")+")"},V=function(d){var a=d.match(/\d+px/i);return a?parseInt(a,10):(a=d.match(/[0-9\.]+em/i))?Math.floor(16*parseFloat(a)):(a=d.match(/\d+pt/i))?Math.floor(1.3333*
parseInt(a,10)):10},ka=function(a){var c=Math.floor(a).toString(),e=parseInt(c.substr(0,1),10);return e*parseFloat("1E"+(c.length-1))==a?a:(e+1)*parseFloat("1E"+(c.length-1))},W=function(a,c){if("object"==typeof c)for(var e in c)a[e]=c[e];return a},la=function(a){a=a||window.event;if("offsetX"in a)return{x:a.offsetX,y:a.offsetY};for(var c=a.target,a={x:a.pageX,y:a.pageY};c.offsetParent;)a.x-=c.offsetLeft,a.y-=c.offsetTop,c=c.offsetParent;return a},ma=function(a,c,e){var b=V(c.font);if(a.pie)return b=
c.x?2*b:!1===e?0:15,[b,b,b,b];var e=Math.floor(b/2),h=m.marks;return a.vertical?[c.y&&/l/i.test(c.ypos)?b+4:c.x?b:0,c.y?b:0,c.y&&/r/i.test(c.ypos)?b+4:c.x?b:1,c.x?60:c.y?b:1]:[c.y?e:0,c.y&&/r/i.test(c.ypos)?4*b:c.x?b:1,c.x?3+b+h:c.y?b:1,c.y&&/l/i.test(c.ypos)?4*b:c.x?e:0]},na=function(a){for(var c={},a=(a||"line").split(":");a.length;)c[a.pop()]=!0;return c},P;if(f.canvas)P=document.getElementById(f.canvas);else a:{var J=f.container,ya=f.width||300,za=f.height||150;P=document.createElement("canvas");
P.setAttribute("width",ya+"px");P.setAttribute("height",za+"px");if(J){if(J="string"==typeof J?document.getElementById(J):J,!J){P=void 0;break a}}else J=document.body;J.appendChild(P)}var x=P,K=x.width,Q=x.height,a=x.getContext("2d"),fa,oa=f.background,j=na(f.mode),S=(f.mode||"line").split(":")[0],pa=(f.fill||"a")[0].toLowerCase().replace(/[^nasvhrdl]+/g,"a"),D=parseFloat(f.opacity)||1,$=parseInt(f.linewidth,10)||1,Aa=f.linejoin||"miter",qa=parseInt(f.radiuspoint,10)||0,ra=f.autoscale&&/top/i.test(f.autoscale),
ga=f.autoscale&&/bot/i.test(f.autoscale),m=W({color:"#a0a0a0",font:'normal 9px "Sans Serif"',marks:0,ypos:"right"},f.labels),k=!1===f.mouseover?!1:W({radius:5,linewidth:$,circle:"#888",font:'normal 10px "Sans Serif"',color:"#fff",bullet:"rgba(99,99,99,0.8)",axis:!1,text:"%v"},f.mouseover),E,v=[],T=!1,sa,ha,ia,ta=f.margins?!1:!0,z=ta?ma(j,m,k):f.margins,u=W({color:"#a0a0a0",x:[0,100],y:[0,25,50,75,100]},f.grid),F=f.title?W({font:'bold 12px "Sans Serif"',color:"rgba(4,4,4,0.5)",x:z[3]+2,y:z[0]+2,z:"top"},
f.title):!1,w=!1===f.legends?!1:W({x:z[3]+2,y:z[0]+2+(f.title&&!f.title.x?2+V(F.font):0),color:"#666",font:'10px "Sans Serif"'},f.legends),q=[],R,A,r=0,L,I,U,y,G,B,C,M,s,X,aa=function(){var a,c,e,b;r=q.length;R=A=!1;I=L=U=0;if(r){for(a=0;a<r;a++)c=q[a],R=!1===R?c.min:Math.min(c.min,R),A=!1===A?c.max:Math.max(c.max,A);ra&&(A=ka(A));if(j.stack){a=0;for(e=q[0].len;a<e;++a){for(c=b=0;c<r;++c)b+=q[c].val[a]||0;b>L&&(L=ra?ka(b):b)}I=ga?L-R:L}else L=A,I=ga?A-R:A;U=ga?R:0}m.fontpx=V(m.font);/none|false/.test(u.x)&&
(u.x=[]);/none|false/.test(u.y)&&(u.y=[]);ta&&(z=ma(j,m,k));y=z[3];G=z[0];B=Math.max(K-z[1]-z[3],0);C=Math.max(Q-z[0]-z[2],0);M=y+B;s=G+C},ua=function(a){var c,e=a.values||a,b=a.labels||[],h={val:[],lab:[],len:0,sum:0,avg:0,max:0,min:0xffffffffffff,tit:a.title||"dataset#"+(q.length+1),col:a.color||Z[q.length%Z.length]};for(c in e)a=parseFloat(e[c]),isNaN(a)&&(a=null),h.val.push(a),h.lab.push(b[c]||c),h.sum+=a,a>h.max&&(h.max=a),a<h.min&&(h.min=a);h.len=h.val.length;h.avg=h.len?h.sum/h.len:0;q.push(h)},
va=function(a){if(a instanceof Array&&"object"==typeof a[0])for(var c=0,e=a.length;c<e;++c)ua(a[c]);else ua(a);aa()},ba=function(d){var c,e;"a"==pa?(D=1,e=j.stack?"v":j.line||j.curve?1<r?"n":"v":j.chart?1<r?"s":j.vertical?"h":"v":j.pie?"r":"s"):e=pa;switch(e){case "s":c=H(d,0,D);break;case "l":c=H(d,21,D);break;case "d":c=H(d,-21,D);break;case "v":c=a.createLinearGradient(0,s,0,G);c.addColorStop(0,H(d,-48,D));c.addColorStop(1,H(d,48,D));break;case "h":c=a.createLinearGradient(y,0,M,0);c.addColorStop(0,
H(d,-48,D));c.addColorStop(1,H(d,48,D));break;case "r":c=y+B/2,e=G+C/2,c=a.createRadialGradient(c,e,0,c,e,C/2),c.addColorStop(0,H(d,-48,D)),c.addColorStop(1,H(d,48,D))}return c?a.fillStyle=c:!1},N=function(d){d&&a.hasOwnProperty("shadowBlur")&&(d=d.split(/[ ,;:-]/),a.shadowOffsetX=parseInt(d[0]||1,10),a.shadowOffsetY=parseInt(d[1]||1,10),a.shadowBlur=parseInt(d[2]||1,10),a.shadowColor=d[3]||"#000")},O=function(){a.hasOwnProperty("clearShadow")?a.clearShadow():a.hasOwnProperty("shadowBlur")&&(a.shadowOffsetX=
0,a.shadowOffsetY=0,a.shadowBlur=0)},wa=function(){F&&(N(F.shadow),a.font=F.font,a.textAlign="left",a.textBaseline="top",a.fillStyle=F.color,a.fillText(F.text,F.x,F.y),O())},ca=function(d,c,e,b,h){a.save();m.x&&0==d%m.x&&(d=q[0].lab[d]||d,N(m.shadow),a.font=m.font,a.fillStyle=m.color,a.textAlign=b||"center",a.textBaseline=h||"alphabetic",a.fillText(d,c,e),O());m.marks&&(a.lineWidth=1,a.beginPath(),a.moveTo(c,s),a.lineTo(c,s+m.marks),a.strokeStyle=m.color,a.stroke());a.restore()},xa=function(d,c){a.save();
a.font=k.font;var e,b,h,l=d.length,g,n,p=0,i=0,da=V(k.font),f=Math.floor(da/2),m=da+3,j,t,Y=K;t=0;j=Q;var r=0;d.sort(function(a,b){return parseInt(b.v,10)-parseInt(a.v,10)});for(b=0;b<l;b++)if(g=d[b],h=q[g.nds].lab[g.n],n=q[g.nds].tit,h="function"==typeof k.text?k.text(g.n,g.v,h,g.x,g.y):k.text.replace("%v",g.v).replace("%l",h).replace("%n",g.n).replace("%t",n).replace("%p",g.pct)){g.lines=h.split(/\n|\\n/);g.h=g.lines.length*m;g.h2=Math.floor(g.h/2);g.w=0;for(e in g.lines)if((h=a.measureText(g.lines[e]).width+
6)>g.w)g.w=h;g.w>i&&(i=g.w);p+=g.h;g.r++;Y>g.x-g.r&&(Y=g.x-g.r);t<g.x+g.r&&(t=g.x+g.r);j>g.y&&(j=g.y);r<g.y&&(r=g.y)}1<l&&(i+=6+da);if(p){p+=3;c?(t=Y+(t-Y)/2-i/2,t+i>K&&(t=K-1-i)):t+i>=K&&(t=Y-i);1>t&&(t=1);t=Math.floor(t);e=t+i;b=j+p/2+p/2;b>s&&(b=s-1);b=Math.floor(b);g=b-p;a.beginPath();a.moveTo(t,b);a.lineTo(e,b);a.lineTo(e,g);a.lineTo(t,g);a.closePath();k.bullet&&(N(k.shadowbox),a.strokStyle="",a.fillStyle=k.bullet,a.fill(),O());k.border&&(a.lineWidth=1,a.lineJoin="round",a.strokeStyle=k.border,
a.stroke());a.textAlign="left";a.textBaseline="top";j=g+3;for(b=0;b<l;b++){g=d[b];p=t+3;1<l&&(a.beginPath(),a.arc(p+f,j+f,f,0,2*Math.PI),a.fillStyle=q[g.nds].col,a.fill(),p+=da+3);N(k.shadow);a.fillStyle=k.color;for(e=0;e<g.lines.length;++e,j+=m)a.fillText(g.lines[e],p,j);O()}}a.restore()},ja={line:function(){var d=r,c=I?C/I:0,e,b,h,l,g,n="curve"==S,p=function(a,b,c,d,e,g){for(var h,l,i,f,j,p;e<=g;)if(null===d[e])e++;else if(n){h=b[e];l=c[e];for(e++;e<=g&&null===d[e];)e++;e>g?a.lineTo(h,l):(i=(h+
b[e])/2,f=(l+c[e])/2,j=(h+i)/2,p=(l+f)/2,a.quadraticCurveTo(h,l,j,p),j=(i+b[e])/2,p=(f+c[e])/2,a.quadraticCurveTo(i,f,j,p))}else a.lineTo(b[e],c[e]),e++};a.lineWidth=$;a.lineJoin=Aa;for(v=[];e=q[--d];)if(1<(g=e.len)){var i=[],f=[];for(b=0;b<g;++b){l=0;if(j.stack)for(h=0;h<=d;h++)l+=q[h].val[b]-U;else l=e.val[b]-U;i.push(y+Math.round(b*(B/(g-1))));f.push(s-Math.round(c*l))}v.push({x:i,y:f,v:q[d].val,nds:d});b--;i.push(y+Math.round(b*(B/(g-1))));f.push(s-Math.round(c*l));for(b=0;null===e.val[b];)b++;
for(h=g-1;null===e.val[h];)h--;b<=h&&ba(e.col)&&(a.beginPath(),a.moveTo(i[b],s),a.lineTo(i[b],f[b]),p(a,i,f,e.val,b,h),a.lineTo(i[h],s),a.closePath(),a.fill());a.strokeStyle=e.col;a.beginPath();a.moveTo(i[b],f[b]);p(a,i,f,e.val,b,h);a.stroke();if(0==d)for(b=0;b<g;++b)ca(b,i[b],Q-3);if(qa){a.fillStyle=e.col;for(b=0;b<g;++b)void 0!=e.val[b]&&(a.beginPath(),a.arc(i[b],f[b],qa,0,2*Math.PI),a.closePath(),a.fill())}}},curve:function(){ja.line()},chart:function(){v=[];if(r){var d,c,e=q[0].len,b=1<r?4:0,
h=j.stack?1:r,l=j.vertical?C:B,l=e&&r?(l-b*(e-1))/e/h-1:0,g,n=G,f,i=y,k,u;d=j.vertical?B:C;var w=j.stack?L?d/L:0:A?d/A:0;0>l&&(l=0);a.lineWidth=$;a.lineJoin="miter";for(c=0;c<r;c++)v.push({x:[],y:[],v:[],nds:c});if(j.vertical)for(d=0;d<e;d++){ca(d,y-m.marks-2,n+l/2,"right","top");i=y;for(c=0;c<r;c++)g=q[c],k=j.stack?i:y,i=k+Math.round(w*g.val[d]),f=Math.round(n),h=Math.round(n+l),null!==g.val[d]&&(a.beginPath(),a.moveTo(k,f),a.lineTo(k,h),a.lineTo(i,h),a.lineTo(i,f),a.closePath(),ba(g.col)&&a.fill(),
a.strokeStyle=g.col,a.stroke()),v[c].x.push(i),v[c].y.push(Math.floor(n+l/2)),v[c].v.push(g.val[d]),j.stack||(n+=l+1);n+=j.stack?l+1+b:b}else for(d=0;d<e;d++){ca(d,i+(l+1)*h/2,Q-3);n=s;for(c=0;c<r;c++)g=q[c],f=j.stack?n:s,n=f-Math.round(w*g.val[d]),k=Math.round(i),u=Math.round(i+l),null!==g.val[d]&&(a.beginPath(),a.moveTo(k,f),a.lineTo(k,n),a.lineTo(u,n),a.lineTo(u,f),a.closePath(),ba(g.col)&&a.fill(),a.strokeStyle=g.col,a.stroke()),v[c].x.push(Math.floor(i+l/2)),v[c].y.push(n),v[c].v.push(g.val[d]),
j.stack||(i+=l+1);i+=j.stack?l+1+b:b}}},pie:function(){v=[];if(r){var d,c=0,e=[],b=[],h=2*Math.PI,l=[],g=[];if(1<r){var f=0;for(d=0;d<r;d++)f+=q[d].sum;if(f){d=0;for(c=r;d<r;d++)e[d]=q[d].sum/f*h,b[d]=q[d].col,l.push(q[d].sum),g.push(Math.round(100*q[d].sum/f))}}else if(f=q[0],f.sum){c=f.len;for(d=0;d<c;d++)e[d]=f.val[d]/f.sum*h,b[d]=Z[d%Z.length],l.push(f.val[d]),g.push(Math.round(100*f.val[d]/f.sum))}var h=y+Math.round(B/2),f=G+Math.round(C/2),j=Math.min(C/2,B/2)-1,i=j+m.fontpx,k,s,u=1.5*Math.PI,
w,t,z,A,x=T;sa=j;ha=h;ia=f;T=x;a.lineWidth=$;a.lineJoin="miter";for(d=0;d<c;d++)w=u+e[d],t=(u+w)/2,v.push({a:u%(2*Math.PI),n:d}),d===x?(k=h+10*Math.cos(t),s=f+10*Math.sin(t)):(k=h,s=f),a.beginPath(),a.moveTo(k,s),a.arc(k,s,j,u,w,!1),a.closePath(),ba(b[d])&&a.fill(),a.strokeStyle=b[d],a.stroke(),d===x?(z=k+i/2*Math.cos(t),A=s+i/2*Math.sin(t)):ca(l[d],k+i*Math.cos(t),s+i*Math.sin(t),"center","middle"),u=w;!1!==x&&xa([{x:z,y:A,r:0,v:l[x],pct:g[x]+"%",n:x,nds:1<r?x:0}],!0);v.sort(function(a,b){return a.a-
b.a})}}},ea={line:function(d,c){var e,b=!1,h,f,g,n=k.linewidth||1,m=[];if(v.length){h=v[0];for(e=0;e<h.x.length;++e)if(void 0!=h.v[e]&&(g=j.vertical?Math.abs(c-h.y[e]):Math.abs(d-h.x[e]),!1===b||g<f))f=g,b=e;if(!1!==b){for(e=0;e<v.length;++e)if(h=v[e],void 0!=h.v[b]){k.border2&&(a.beginPath(),a.lineWidth=n+2,a.arc(h.x[b],h.y[b],k.radius,0,2*Math.PI),0==k.linewidth?(a.fillStyle=k.border2,a.fill()):(a.strokeStyle=k.border2,a.stroke()));a.beginPath();a.lineWidth=n;a.arc(h.x[b],h.y[b],k.radius,0,2*Math.PI);
0==k.linewidth?(a.fillStyle=k.circle,a.fill()):(a.strokeStyle=k.circle,a.stroke());if(k.axis){a.lineWidth=1;if(/x/i.test(k.axis)){for(f=h.y[b]+k.radius;f<s;)a.moveTo(h.x[b],f),f+=2,f>s&&(f=s),a.lineTo(h.x[b],f),f+=2;a.stroke()}if(/y/i.test(k.axis)){for(d=h.x[b]+k.radius;d<M;)a.moveTo(d,h.y[b]),d+=2,d>M&&(d=M),a.lineTo(d,h.y[b]),d+=2;a.stroke()}}m.push({x:h.x[b],y:h.y[b],r:n/2+1+k.radius,v:h.v[b],n:b,nds:h.nds})}xa(m)}}},chart:function(a,c){ea.line(a,c)},curve:function(a,c){ea.line(a,c)},pie:function(a,
c){var e,b=0;if(Math.sqrt(Math.pow(a-ha,2)+Math.pow(c-ia,2))<=sa){e=Math.PI-Math.atan2(ia-c,a-ha);for(e=(e+3*Math.PI)%(2*Math.PI);b<v.length&&e>v[b].a;)b++;0>--b&&(b=v.length-1);T=v[b].n;X(!0)}else!1!==T&&(T=!1,X(!0))}};X=function(d){a.clearRect(-1,-1,K+1,Q+1);oa&&(a.fillStyle=oa,a.fillRect(-1,-1,K+1,Q+1));if(!j.pie){var c,e,b;a.lineWidth=u.linewidth||1;a.strokeStyle=u.color;if(u.x){c=0;for(e=u.x.length;c<e;++c)a.beginPath(),j.vertical?(b=G+Math.round(C*u.x[c]/100),a.moveTo(y,b),a.lineTo(M,b)):(b=
y+Math.round(B*u.x[c]/100),a.moveTo(b,G),a.lineTo(b,s)),a.stroke()}if(u.y){c=0;for(e=u.y.length;c<e;++c)a.beginPath(),j.vertical?(b=y+Math.round(B*u.y[c]/100),a.moveTo(b,G),a.lineTo(b,s)):(b=s-Math.round(C*u.y[c]/100),a.moveTo(y,b),a.lineTo(M,b)),a.stroke()}}if(r&&m.y&&!j.pie){var h,f,g=10>I?100:100>I?10:1;N(m.shadow);a.font=m.font;a.fillStyle=m.color;if(j.vertical){a.textAlign="center";c=0;for(e=m.y.length;c<e;++c)b=y+Math.round(B*m.y[c]/100),f=U+I*m.y[c]/100,f=Math.round(g*f)/g,/r/i.test(m.ypos)&&
(h=s+1,a.textBaseline="top",a.fillText(f,b,h)),/l/i.test(m.ypos)&&(h=G-2,a.textBaseline="bottom",a.fillText(f,b,h))}else{a.textBaseline="middle";c=0;for(e=m.y.length;c<e;++c)h=s-Math.round(C*m.y[c]/100),f=U+I*m.y[c]/100,f=Math.round(g*f)/g,/r/i.test(m.ypos)&&(b=M+1,a.textAlign="left",a.fillText(f,b,h)),/l/i.test(m.ypos)&&(b=y-2,a.textAlign="right",a.fillText(f,b,h))}O()}F&&"top"==F.z?(ja[S](),wa()):(wa(),ja[S]());if(!1!==w&&1<r){a.save();a.font=w.font;var n,p,g=0;e=V(w.font)+3;b=e-3;h=r;p=3+e*h;f=
w.x;var i=w.y;for(c=0;c<h;++c)if((n=a.measureText(q[c].tit)).width>g)g=n.width;n=9+b+g;a.lineWidth=1;if(g=w.background)N(w.shadowbox),a.fillStyle=g,a.fillRect(f,i,n,p),O();if(g=w.border)a.strokeStyle=g,a.strokeRect(f,i,n,p);c=0;for(n=i+3;c<h;++c,n+=e){p=q[c];N(w.shadow);a.fillStyle=p.col;a.fillRect(f+3,n,b,b);O();if(g=w.border2)a.strokeStyle=g,a.strokeRect(f+3,n,b,b);N(w.shadow);a.textAlign="left";a.textBaseline="top";a.fillStyle=w.color;a.fillText(p.tit,f+6+b,n);O()}a.restore()}if(!d)if(x.onmouseover=
x.onmousemove=x.onmouseout=void 0,T=!1,k){fa=a.getImageData(0,0,K,Q);if(E)ea[S](E.x,E.y);x.onmouseover=function(a){E=la(a)};x.onmousemove=function(b){E&&(j.pie||a.putImageData(fa,0,0),E=la(b),ea[S](E.x,E.y))};x.onmouseout=function(){E=void 0;a.putImageData(fa,0,0)}}else E=void 0};a.translate(0.5,0.5);f.datas?va(f.datas):aa();X();return{canvas:x,data:q,clear:function(){q=[];r=0;aa();return this},load:function(a){va(a);return this},cls:function(){return this},draw:function(a){a&&(S=(a||"line").split(":")[0],
j=na(a),aa());X();return this}}},plotter=harry;